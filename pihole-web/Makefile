include $(TOPDIR)/rules.mk

PKG_NAME:=pihole-web
PKG_VERSION:=4.0
PKG_RELEASE:=1

PKG_SOURCE_VERSION:=af8c926cefd3f06dbbba0131b7644a1bb45cd514
PKG_SOURCE:=$(PKG_SOURCE_VERSION).tar.gz
PKG_SOURCE_URL:=https://github.com/pi-hole/AdminLTE/archive
PKG_HASH:=640cb417e05fc60df3c32b5c9ce3458a27faa89c5b07dc317036bf5820aecc99

PKG_LICENSE:=EUPL
PKG_LICENSE_FILES:=LICENSE

PKG_BUILD_DIR:=$(BUILD_DIR)/AdminLTE-$(PKG_SOURCE_VERSION)

include $(INCLUDE_DIR)/package.mk

define Package/pihole-web
  SECTION:=net
  CATEGORY:=Network
  TITLE:=Pi-hole Dashboard for stats and more
  URL:=https://pi-hole.net/
  DEPENDS:=pihole +lighttpd +lighttpd-mod-access +lighttpd-mod-fastcgi +lighttpd-mod-setenv +php7 +php7-fpm +php7-mod-hash +php7-mod-json +php7-mod-openssl +php7-mod-phar +php7-mod-session +php7-mod-sqlite3 +procps-ng-ps +sudo
  PKGARCH:=all
endef

define Package/pihole-web/description
  Pi-hole®'s Web interface (based off of AdminLTE) provides a central location to manage your Pi-hole and review the statistics generated by FTLDNS™.
endef

define Package/pihole-web/conffiles
/etc/lighttpd/conf.d/99-pihole.conf
endef

define Build/Compile
endef

define Package/pihole-web/install
	$(INSTALL_DIR) $(1)/etc/lighttpd/conf.d
	$(INSTALL_DATA) ./files/lighttpd.conf $(1)/etc/lighttpd/conf.d/99-pihole.conf
	$(INSTALL_DIR) $(1)/etc/sudoers.d
	$(INSTALL_DATA) ./files/pihole.sudo $(1)/etc/sudoers.d/pihole
	$(INSTALL_DIR) $(1)/www/admin
	$(CP) -r $(PKG_BUILD_DIR)/{img,scripts,style,.user.php.ini,*.php} $(1)/www/admin/
	$(INSTALL_DIR) $(1)/www/pihole
	$(INSTALL_DATA) ./files/blockingpage.css $(1)/www/pihole/
	$(INSTALL_DATA) ./files/index.php $(1)/www/pihole/
endef

$(eval $(call BuildPackage,pihole-web))
